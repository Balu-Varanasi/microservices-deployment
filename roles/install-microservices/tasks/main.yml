---

  - name: Stop/Removes microservice containers if running (Idempotence)
    docker:
      image: "{{item.image}}"
      state: absent
    with_items: dockerhub_microservices

  - name: Remove microservice images, if present, to avoid stale versions (Idempotence)
    docker_image: name="{{item.image}}" state=absent
    with_items: dockerhub_microservices

  - name: Launch Microservices
    docker:
      name: "{{item.name}}"
      image: "{{item.image}}"
      state: started
      ports: "{{item.ports}}"
      # restart_policy: "on-failure"
    with_items: dockerhub_microservices
